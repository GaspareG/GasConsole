<html>
	<head>
		<title>Game4</title>
		<style>
			body {
				margin: 0px ;
				padding: 0px ;
				background: #ccc ;
			}

			#canvas { 
				width: 1000px ;
				height: 500px ;
			}
		</style>
	</head>	
	<body>
		<canvas height="500px" width="1000px" id="canvas"></canvas>
		<script>

			// Variabili Globali
			var canvas   = document.getElementById("canvas");
			var ctx      = canvas.getContext("2d");
			var width    = 1000 ;
			var height   = 500 ;

			var pos     = [[250,250],[750,250]];
			var player  = [false,false] ;
			var offline = [false,false] ;
			var point   = [0,0] ;
			
                        var wsServer = null ;
                        var wsRead = false ;

                        function mandaMsg(numero, msg)
                        {
                                wsServer.send( JSON.stringify({ type: "news", to: numero, info: msg }) );
                        }

			document.addEventListener("DOMContentLoaded",function(){

				// Connessione WebSocket
                        	wsServer = new WebSocket("ws://88.198.124.71:6060");
                        	wsReady = false ;

                        	wsServer.onopen = function(){
                                	wsServer.send("SERVER");
       	                        	wsReady = true ;
	                        };

				// Parsing Input
				wsServer.onmessage = function(event){
					var data = JSON.parse(event.data);
					
					if( !Array.isArray(data) )
                                        {
                                                if( data.event == "press" &&
                                                    (data.value == "A" || data.value == "B") ) spara();
                                                else if(data.event == "press" && data.value == "R" )
                                                        location.href = "game4.html" ;
                                                else if(data.event == "press" && data.value == "H" )
                                                        location.href = "home.html" ;
						return ;
                                        }

					player  = [false,false] ;
					offline = [false,false] ;
					
					if( data.length >= 1 ) player[0] = true ;
					if( data.length >= 2 ) player[1] = true ;


					for(var i=0; i<2; i++)
					{
						if( !player[i] ) continue ;
						if( data[i].offline )
						{
							offline[i] = true ;
							continue ;
						}
	
					}
				};
				
				// Refresh Gioco
				var update = setInterval(function(){

					// Pulisco 
					ctx.fillStyle = "#000";
 					ctx.fillRect(0,0,width,height);

					// Stili 
					ctx.fillStyle = "white" ;
					ctx.strokeStyle = "white" ;
					ctx.lineWidth = 3 ;


                                        // Cursore Giocatore
					var r = 20 ;
					ctx.fillStyle = "white" ;
					ctx.fillRect(pos[0][0]-r/2, pos[0][1]-r/2,r,r);
                                        ctx.fillRect(pos[1][0]-r/2, pos[1][1]-r/2,r,r);


                                        // Punti
                                        ctx.font = "50px Arial" ;
					ctx.fillStyle = "white" ;
                                        ctx.textAlign = "right" ;
                                        ctx.fillText(point[0], width-10,50);
					ctx.textAlign = "left" ;
					ctx.fillText(point[1], 10, 50);

					// Wait player
					if( !player[0] )
					{
						ctx.fillStyle = "rgba(0,0,0,0.5)";
						ctx.fillRect(0,0,width,height);
		                                ctx.font = "50px Arial" ;
	                                        ctx.textAlign = "center" ;
						ctx.fillStyle = "white" ;
        	                                ctx.fillText("Waiting for Player 1!", width/2,height/2);
						return;
					} 
					else if( !player[1] )
                                        {
                                                ctx.fillStyle = "rgba(0,0,0,0.5)";
                                                ctx.fillRect(0,0,width,height);
                                                ctx.font = "50px Arial" ;
                                                ctx.textAlign = "center" ;
                                                ctx.fillStyle = "white" ;
                                                ctx.fillText("Waiting for Player 2!", width/2,height/2);
                                                return;
                                        } 

					// Offline player
					if( offline[0] )
					{
                                                ctx.fillStyle = "rgba(0,0,0,0.5)";
                                                ctx.fillRect(0,0,width,height);
                                                ctx.font = "50px Arial" ;
                                                ctx.textAlign = "center" ;
                                                ctx.fillStyle = "white" ;
                                                ctx.fillText("Player 1 offline!", width/2,height/2);
                                                return;
					}	
					else if( offline[1] )
                                        {
                                                ctx.fillStyle = "rgba(0,0,0,0.5)";
                                                ctx.fillRect(0,0,width,height);
                                                ctx.font = "50px Arial" ;
                                                ctx.textAlign = "center" ;
                                                ctx.fillStyle = "white" ;
                                                ctx.fillText("Player 2 offline!", width/2,height/2);
                                                return;
                                        } 


					// Game!!				


				},35);
		
			});				
		</script>
	</body>
</html>
